name: Auto Refuel

on:
  schedule:
    # Run every 1 hours
    - cron: "19 */1 * * *"
  workflow_dispatch:
    inputs:
      dry_run:
        description: "Dry run (no broadcast)"
        type: boolean
        default: true
      chains:
        description: "Chains to refuel (comma-separated: gnosis,ethereum,base or all)"
        type: string
        default: "all"

jobs:
  refuel:
    runs-on: ubuntu-latest
    environment: mainnet
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          sparse-checkout: |
            contracts
            scripts

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          enable-cache: true
          cache-dependency-glob: "uv.lock"

      - name: Run refuel
        env:
          PRIVATE_KEY: ${{ secrets.REFUEL_PRIVATE_KEY }}
          ALCHEMY_RPC_API_KEY: ${{ secrets.ALCHEMY_RPC_API_KEY }}
        run: |
          ARGS=""

          # Add chains if specified (convert comma to space)
          if [ -n "${{ inputs.chains }}" ] && [ "${{ inputs.chains }}" != "all" ]; then
            ARGS="--chains $(echo '${{ inputs.chains }}' | tr ',' ' ')"
          fi

          # Add dry-run for manual runs only
          if [ "${{ github.event_name }}" = "workflow_dispatch" ] && [ "${{ inputs.dry_run }}" = "true" ]; then
            ARGS="$ARGS --dry-run"
          fi

          uv run scripts/auto_refuel.py $ARGS
